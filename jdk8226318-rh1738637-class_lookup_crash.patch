# HG changeset patch
# User mbalao
# Date 1560878590 10800
#      Tue Jun 18 14:23:10 2019 -0300
# Node ID d790adc3bb57a28b26502814839a9308112a35a0
# Parent  c066fa11f8ede0ab75742aba76823341d8e36e87
8226318: Class Loader Dependencies improvements
Reviewed-by: adinn

diff --git openjdk.orig/hotspot/src/share/vm/classfile/classLoaderDependencies.cpp openjdk/hotspot/src/share/vm/classfile/classLoaderDependencies.cpp
--- openjdk.orig/hotspot/src/share/vm/classfile/classLoaderDependencies.cpp
+++ openjdk/hotspot/src/share/vm/classfile/classLoaderDependencies.cpp
@@ -76,6 +76,7 @@
 
   // Must handle over GC points
   assert (last != NULL, "dependencies should be initialized");
+  objArrayHandle head_handle(THREAD, list_head);
   objArrayHandle last_handle(THREAD, last);
 
   // Create a new dependency node with fields for (class_loader, next)
@@ -86,7 +87,7 @@
   objArrayHandle new_dependency(THREAD, deps);
 
   // Add the dependency under lock
-  ClassLoaderDependencies::locked_add(objArrayHandle(THREAD, list_head),
+  ClassLoaderDependencies::locked_add(head_handle,
                                       last_handle,
                                       new_dependency,
                                       THREAD);
